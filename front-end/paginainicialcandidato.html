<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./CSS/style.css" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./CSS/navega√ßao.css">
    <link rel="icon" type="image/x-icon" href="./CSS/imagens/iconedosite.png">
    <title>Vagas Dispon√≠veis</title>
</head>
<body>
    <header>
        <div class="borda"></div>
        <ul>
            <li class="drop">
                <button class="botaodrop" style="height: 50px; width: 60px;">
                    <img style="height: 20px; width: 30px;" src="./CSS/imagens/tracos.png" alt="Menu">
                </button>
                <div class="dropconteudo">
                    <div style="height: 40px;"></div>
                    <a href="./verperfil.html">Ver Perfil</a>
                    <a href="">Feed</a>
                    <a href="">Procurar Vagas</a>
                    <a href="./mensagens.html">Mensagens</a>
                    <a href="./contatos.html">Notifica√ß√µes</a>
                    <a href="./configura√ß√µes.html">Configura√ß√µes</a>
                    <a href="./login.html" id="btnLogout" style="cursor:pointer; color:white;">Sair</a>
                </div>
            </li>

            <img style="float: left; height: 80px; width: 80px; border-radius: 50%; margin: 10px;" src="./CSS/imagens/iconedosite.png">

            <li><input class="pesquisa" type="text" id="search-input" placeholder="Pesquisar"></li>
            <li><button class="btn btn-secondary" id="toggle-dark-mode" style="height: 40px; width: 40px; border-radius: 50%;">üåô</button></li>
        </ul>
    </header>

    <section>
        <div class="carrossel">
            <div class="slides">
                <img src="https://images.stockcake.com/public/b/1/7/b1714ff0-03bb-405d-a4a6-7b43efeb3c33_large/coding-late-night-stockcake.jpg" alt="img1">
                <img src="https://blog.unoeste.br/wp-content/uploads/2021/05/faculdade-engenharia-civil.jpg" alt="img2">
                <img src="https://lh5.googleusercontent.com/Gy4G-1-wIEJKYSmW2E0mHT2jpA2VCn1KdkNe_tTm5-gnsheJV3XtfCVV1_T_CKz1oYhGgxn9YYoB9jD21Ro9mHnQa8LgeNUK_9JQem7kX-thxcGBJkzqATKcmLLEvV8gCTSqBmls" alt="img3">
                <img src="https://tse3.mm.bing.net/th/id/OIP.M8L3qm6wJES7jmTh_khBngHaE8?w=1221&h=815&rs=1&pid=ImgDetMain&o=7&rm=3" alt="img4">
            </div>
        </div>
    </section>

    <section class="vaga-container py-5">
        <div class="container">
            <h1 class="textovagas" style="margin-bottom: 40px;">Vagas Dispon√≠veis</h1>

            <!-- Filtros -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <input type="text" class="form-control" id="search-cargo" placeholder="Buscar por cargo ou empresa">
                </div>
                <div class="col-md-4">
                    <select class="form-select" id="search-localizacao">
                        <option selected>Selecione uma localiza√ß√£o</option>
                        <option value="S√£o Paulo">S√£o Paulo</option>
                        <option value="Rio de Janeiro">Rio de Janeiro</option>
                        <option value="Belo Horizonte">Belo Horizonte</option>
                        <option value="Curitiba">Curitiba</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <select class="form-select" id="search-tipo">
                        <option selected>Filtrar por tipo de trabalho</option>
                        <option value="Tempo Integral">Tempo Integral</option>
                        <option value="Meio Per√≠odo">Meio Per√≠odo</option>
                        <option value="Freelancer">Freelancer</option>
                    </select>
                </div>
            </div>

            <div class="row g-4" id="vaga-container"></div>
        </div>
    </section>

    <!-- Modal Detalhes da Vaga -->
    <div class="modal fade" id="modalDetalhes" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="modal-titulo" class="modal-title"></h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <img id="modal-imagem" class="img-fluid" alt="Imagem Vaga">
                        </div>
                        <div class="col-md-6">
                            <p><strong>Descri√ß√£o:</strong> <span id="modal-descricao"></span></p>
                            <p><strong>Localiza√ß√£o:</strong> <span id="modal-localizacao"></span></p>
                            <p><strong>Tipo de Trabalho:</strong> <span id="modal-tipo"></span></p>
                            <p><strong>Contato:</strong> <span id="modal-contato"></span></p>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button class="btn btn-primary">Candidatar-se</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="rodape">
            <p>&copy; 2025 FusionDevs. Todos os direitos reservados.</p>
            <div class="links">
                <a href="/politica-de-privacidade">Pol√≠tica de Privacidade</a> |
                <a href="/termos-de-servico">Termos de Servi√ßo</a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>
// ==========================
//   CARREGAR VAGAS DA API
// ==========================
document.addEventListener("DOMContentLoaded", () => {
    const API_URL = "https://faithful-spirit-teste1.up.railway.app/tcc/busca_Vaga";
    const container = document.getElementById("vaga-container");
    let vagas = [];

    async function carregarVagas() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error("Erro ao buscar vagas");

            const data = await response.json();

            if (!data.length) {
                container.innerHTML = `<p style="color:red; font-weight:bold;">Nenhuma vaga cadastrada.</p>`;
                return;
            }

            vagas = data.map(v => ({
                id: v.id_vaga,
                titulo: v.area_de_trabalho,
                empresa: v.nome_empresa,
                salario: v.salario,
                cidade: v.cidade_empresa,
                estado: v.estado_empresa,
                is_pcd: v.is_pcd,
                descricao: v.descricao || "‚Äî",
                imagem: v.imagem ?? "./css/imagens/Designer.png",
                tipoTrabalho: "Tempo Integral"
            }));

            criarCards(vagas);
        } catch (err) {
            container.innerHTML = `<p style="color:red;">Erro ao conectar ao servidor.</p>`;
        }
    }

    function criarCards(lista) {
        container.innerHTML = "";

        lista.forEach((vaga, index) => {
            const card = document.createElement("div");
            card.className = "col-md-4";

            card.innerHTML = `
                <div class="card shadow-sm">
                    <img src="${vaga.imagem}" class="card-img-top">
                    <div class="card-body">
                        <h5 class="card-title">${vaga.titulo}</h5>
                        <p><strong>Empresa:</strong> ${vaga.empresa}</p>
                        <p><strong>Localiza√ß√£o:</strong> ${vaga.cidade} - ${vaga.estado}</p>
                        <p><strong>Sal√°rio:</strong> R$ ${vaga.salario}</p>
                        ${vaga.is_pcd ? '<span class="badge bg-success">PCD</span>' : ''}
                        <button class="btn btn-primary mt-2" data-index="${index}">Detalhes</button>
                    </div>
                </div>
            `;

            container.appendChild(card);
        });

        document.querySelectorAll("button[data-index]").forEach(btn => {
            btn.addEventListener("click", e => {
                mostrarDetalhesVaga(e.target.getAttribute("data-index"));
            });
        });
    }

    function mostrarDetalhesVaga(i) {
        const v = vagas[i];

        document.getElementById("modal-titulo").innerText = v.titulo;
        document.getElementById("modal-imagem").src = v.imagem;
        document.getElementById("modal-descricao").innerText = v.descricao;
        document.getElementById("modal-localizacao").innerText = `${v.cidade} - ${v.estado}`;
        document.getElementById("modal-tipo").innerText = v.tipoTrabalho;
        document.getElementById("modal-contato").innerText = v.empresa;

        new bootstrap.Modal(document.getElementById("modalDetalhes")).show();
    }

    // ==========================
    //     FILTROS
    // ==========================
    function aplicarFiltros() {
        const cargo = document.getElementById("search-cargo").value.toLowerCase();
        const loc = document.getElementById("search-localizacao").value;

        const filtradas = vagas.filter(v =>
            (v.titulo.toLowerCase().includes(cargo) || v.empresa.toLowerCase().includes(cargo)) &&
            (loc === "Selecione uma localiza√ß√£o" || v.cidade.includes(loc))
        );

        criarCards(filtradas);
    }

    document.getElementById("search-cargo").addEventListener("input", aplicarFiltros);
    document.getElementById("search-localizacao").addEventListener("change", aplicarFiltros);

    carregarVagas();
});


// ==========================
//    VERIFICAR LOGIN
// ==========================
document.addEventListener("DOMContentLoaded", () => {
    const token = localStorage.getItem("token");
    const btnCriarConta = document.getElementById("botaocriar");

    if (token) {
        if (btnCriarConta) btnCriarConta.style.display = "none";
    }
});
</script>

<script src="./js/darkmode.js"></script>
</body>
</html>
